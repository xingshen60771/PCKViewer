# 《PCK Viewer》软件源代码   

欢迎学习《PCK Viewer》软件源代码！本源码讨论的话题是早期国产游戏的资源文件算法的分析，以及资源文件的浏览，是一份研究游戏安全，提升数据保护防范措施的学术资料。   
本源码遵循Creative Commons Attribution - NonCommercial许可协议，禁止商业用途！   

### 郑重声明  
1、本工具提供的所有功能仅限个人学习研究使用，通过本工具所获得的游戏资源文件之版权归相关公司所有，严禁将所获得的游戏资源文件用于其他用途，工具设计者概不承担因而造成的一切后果。   
2、软件遵循Creative Commons Attribution - NonCommercial许可协议，禁止用于商业用途。   
   
 ### 基本信息   
源码名称：PCK Viewer   
源码版本：1.1.0  
源码作者：52pojie.cn  
遵循协议：Creative Commons Attribution - NonCommercial    
源码语言：C#  
.NET Framework框架版本：4.5  

### 基本介绍
本工具用于演示PCK格式的游戏资源文件的解压缩功能，支持部分格式为PCK国产老游戏的资源文件，同时还引入了第三方类库FreeImage和NAudio，实现图像和声音浏览功能。本软件演示了PCK文件算法的文件偏移、大小、文件目录信息的存储方式和数据区的内容存储规则，对研究资源逆向基础提供了重要参考资料。  

### 更新日志  
--------------------------------------------------  
2024.11.18 ——V 1.1.0  
1、项目更名为《PCK Viewer》  。
2、更换了Zlib解压库，改用zlib.dll提供的API来执行解压，同时移除了DotNetZip类库。      
3、优化了PCK文件目录区解析流程。  
4、新增文件浏览功能，支持浏览文本、图像和音频文件。  
  
--------------------------------------------------  
2024.10.30 ——V 1.0.0  
1、PCK解压算法讨论帖发布。  
2、初代图形界面开发完成。  
  
--------------------------------------------------  
2024.10.27 ——V 0.5.0  
1、PCK解压算法研究完成，关键代码完成编写，进入立项阶段。  

### 如何编译  
1、本软件使用了Tuple多元List，因此依赖于.NET Framework V4.5运行，原则上Visual Studio 2015就可以编译，但是本人是在Visual Studio 2022中编译的，因此建议在Visual Studio 2022中编译。  
2、编译后，无论是否在release状态下，务必把zlib1.dll和FreeImage.dll拷贝到程序运行文件夹，否则程序无法正常运行。   

### 关于解压错误码
PCK文件压缩算法为Zlib，本工具引入了Zlib官方DLL插件进行解压，官方对解压API的有关错误的返回值描述如下：   
1、Z_STREAM_ERROR(错误码:-2)   
表示文件流异常。   
2、Z_DATA_ERROR(错误码:-3)   
表示被解压的数据有错误。所谓的数据错误可能是非Zlib数据、数据损坏、校验不正确等客观因素造成的。   
3、Z_MEM_ERROR(错误码:-4)   
表示内存不足。   
5、Z_BUF_ERROR(错误码:5)   
表示分配的缓存区大小不足。   
6、Z_VERSION_ERROR(错误码:-6）   
表示被解压的数据与Zlib版本不兼容。   

### 待解决问题    
1、游戏《大秦悍将》的PCK文件有部分文件解压报错显示数据损坏，后对PCK文件进行Hex数据分析，按照目录表所指引的文件偏移和大小将问题文件的压缩数据拷贝出来后发现：问题文件的数据存在多个Zlib压缩头部标识0x78、0x01，推测可能是游戏在安装更新时，文件被补丁过导致，但按照Zlib压缩头部标识分段尝试手动解压依然无法解决，希望技术佬给与指导。其他游戏没有报错，均能正常、完整的解压。   
2、TGA及带有透明像素的图片保存成其他格式后出现像素异常的问题，可能是FreeImage引入有问题，原因不明，建议将TGA解压后在转换。   

### 意见或建议
可通过论坛回帖留言的方式反馈，也可私信该帖楼主也就是我来反馈。禁止留QQ、微信等联系方式，对利用私信留联系方式的行为将从重处罚！  
 

This project is licensed under Creative Commons Attribution - NonCommercial (CC BY - NC). You are free to use the source code for non - commercial purposes only.
